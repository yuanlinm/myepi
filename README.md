# 📦 myepi：高效、灵活的流行病学回归与可视化工具包

**myepi** 是一个面向流行病学研究的数据分析辅助工具包，旨在简化队列研究中的回归建模与结果展示流程。该包集成了模型拟合与结果可视化的常用功能，特别适用于 Cox 比例风险模型分析与分组亚组研究。

## Installation
```R
# 若希望直接更新该R包，则在未加载 FORESTPLOT.PAC 的基础上直接运行下方代码即可
devtools::install_github("yuanlinm/myepi")
library(myepi)
```

## 🔍 核心功能

### 1. `cox_run()`：一行代码完成 Cox 模型拟合与亚组分析

- **智能模型构建**：自动识别变量类型，支持连续变量与分类变量建模。
- **多模型一体输出**：支持多组模型并行运行，输出统一格式的结果表，便于整理与后续绘图。
- **稳健性检查**：提供默认的模型错误检测与提示，防止变量缺失或格式错误导致的失败。

**示例用法**：

```r
res <- myepi::cox_run(
  df = data,
  time = "followup_time",
  status = "outcome",
  risk = "exposure",
  covs = c("age", "sex"),
  g_var = "group"
)
```

**结果示例**

| group   | level | g_levels | case_total | incidence | hr   | hr_lower | hr_upper | beta | se   | p     |
|---------|-------|----------|-------------|-----------|------|----------|----------|------|------|-------|
| smoke   | No    | All      | 80/1500     | 125.60    | 1.00 | 1      | 1      | 0  | 0  | 1   |
| smoke   | Yes   | All      | 123/1000    | 245.78    | 1.75 | 1.30     | 2.35     | 0.56 | 0.15 | 0.001 |
| pm2.5   | Low   | male      | 60/1400     | 85.50     | 1.00 | 1      | 1      | 0  | 0  | 1   |
| pm2.5   | High  | female      | 95/1100     | 215.00    | 1.60 | 1.20     | 2.10     | 0.47 | 0.14 | 0.002 |
| pm2.5   | Low   | male      | 60/1400     | 85.50     | 1.00 | 1      | 1      | 0  | 0  | 1   |
| pm2.5   | High  | female      | 95/1100     | 215.00    | 1.60 | 1.20     | 2.10     | 0.47 | 0.14 | 0.002 |



---




### 2. `forestplot()`: 高质量、灵活可调的森林图绘制工具

- **多列信息展示**：支持左右两侧添加任意自定义列（如变量名称、HR值、95%CI、P值等）。
- **全参数可调节**：图形的颜色、大小、字体、间距、置信区间线型等均可自定义，满足审稿图或演示图的精细化需求。
- **支持科学记数法P值**：内置科学计数法格式化方案，适配流行病学常见的极小P值展示。
- **与 cox_run() 无缝衔接**：可直接使用 cox_run() 的结果表进行绘图，一键生成高质量出版级别森林图。

**示例用法**：
```r
myepi::forestplot(df = df,left_side_cols = c(1:4),
      right_side_cols = c(11:12),
      estimate = 'HR',
      lower = 'HR_lower',
      upper = 'HR_upper',
      p_value_col = 'P'
)
```
**结果示例**
![x效果展示](temp.png)

